(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{172:function(e,t,n){e.exports=n(372)},177:function(e,t,n){},372:function(e,t,n){"use strict";n.r(t);var a=n(40),r=n(0),s=n.n(r),i=n(33),o=n.n(i),c=(n(177),n(14)),l=n(15),u=n(17),m=n(16),p=n(18),d=n(34),h=n(54),v=n(55),E=n.n(v);function g(){var e=Object(h.a)(["\n  query {\n    me {\n      id\n      user {\n        id\n        username\n      }\n      createdAt\n      marblelympicsParticipated(marblelympics_Active: true) {\n        edges {\n          node {\n            id\n            points\n            rank\n            marblelympics {\n              id\n              year\n              playerCount\n              host {\n                id\n                name\n              }\n              teams {\n                edges {\n                  node {\n                    id\n                    name\n                    cdnImage\n                  }\n                }\n              }\n              events {\n                edges {\n                  node {\n                    id\n                    ml {\n                      year\n                    }\n                    number\n                    name\n                    entryCount\n                    status\n                  }\n                }\n              }\n            }\n            eventEntries {\n              edges {\n                node {\n                  id\n                  player {\n                    id\n                  }\n                  event {\n                    id\n                    ml {\n                      year\n                    }\n                    number\n                    name\n                  }\n                  points\n                  rank\n                  selections {\n                    position\n                    team {\n                      id\n                      name\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n"]);return g=function(){return e},e}function b(){var e=Object(h.a)(["\n  mutation EventEntryMutation(\n    $eventNumber: Int!\n    $team1: String!\n    $team2: String!\n    $team3: String!\n  ) {\n    upsertPlayerEntry(\n      input: {\n        eventNumber: $eventNumber\n        team1: $team1\n        team2: $team2\n        team3: $team3\n      }\n    ) {\n      entry {\n        id\n        player {\n          id\n        }\n        event {\n          id\n          ml {\n            year\n          }\n          number\n          name\n        }\n        points\n        rank\n        selections {\n          position\n          team {\n            id\n            name\n          }\n        }\n      }\n    }\n  }\n"]);return b=function(){return e},e}function f(){var e=Object(h.a)(["\n  mutation SignupMutation($username: String!, $password: String!) {\n    createPlayer(input: { username: $username, password: $password }) {\n      player {\n        id\n        createdAt\n        user {\n          id\n          username\n        }\n      }\n    }\n  }\n"]);return f=function(){return e},e}function y(){var e=Object(h.a)(["\n  mutation LoginMutation($username: String!, $password: String!) {\n    tokenAuth(username: $username, password: $password) {\n      token\n    }\n  }\n"]);return y=function(){return e},e}var O=E()(y()),j=E()(f()),w=E()(b()),k=E()(g()),S=n(83),C=n(26),x=n(77),N=n.n(x),A=n(146),T=n.n(A),I=n(19),L=n.n(I),P=n(42),$=n.n(P),D="FML_AUTH_TOKEN",M=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return s.a.createElement("div",{className:t.root},s.a.createElement(N.a,{position:"fixed",className:t.appBar},s.a.createElement(T.a,null,s.a.createElement(L.a,{variant:"h6",color:"inherit",className:t.grow},"FML ",this.props.year),s.a.createElement($.a,{color:"inherit",onClick:function(){localStorage.removeItem(D),e.props.history.push("/login")}},"Logout"))))}}]),t}(s.a.Component),F=Object(C.withStyles)(function(e){return{root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},grow:{flexGrow:1},menuButton:{marginLeft:-12,marginRight:20}}})(M),W=n(148),z=n.n(W),B=n(149),_=n.n(B),U=n(150),R=n.n(U),q=n(151),H=n.n(q),J=n(35),G=n.n(J),K=n(79),V=n.n(K),Q=n(152),X=n.n(Q),Y=n(153),Z=n.n(Y),ee=n(154),te=n.n(ee),ne=n(147),ae=n.n(ne),re=n(78),se=n.n(re),ie=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,-1!==this.props.enteredEvents.indexOf(this.props.event.id)?s.a.createElement(ae.a,null):"",4===this.props.event.status?s.a.createElement(se.a,null):"")}}]),t}(s.a.Component),oe=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return s.a.createElement(V.a,{className:t.drawer,variant:"permanent",classes:{paper:t.drawerPaper}},s.a.createElement("div",{className:t.toolbar}),s.a.createElement(z.a,null,Object.keys(this.props.events).map(function(t){return s.a.createElement(_.a,{key:t},s.a.createElement(R.a,null,s.a.createElement(G.a,null,e.props.events[t].number)),s.a.createElement(H.a,{primary:e.props.events[t].name,secondary:s.a.createElement(ie,{event:e.props.events[t],enteredEvents:e.props.enteredEvents})}),s.a.createElement(X.a,null,s.a.createElement(Z.a,{"aria-label":"go-to-event",onClick:function(){return e.props.switchEvent(t)}},s.a.createElement(te.a,null))))})))}}]),t}(s.a.Component),ce=Object(C.withStyles)(function(e){return{drawer:{width:320,flexShrink:0},drawerPaper:{width:320},toolbar:e.mixins.toolbar}})(oe),le=n(85),ue=n(74),me=n.n(ue),pe=n(44),de=n.n(pe),he=n(45),ve=n.n(he),Ee=n(155),ge=n.n(Ee),be={winnersAvatar:{color:"#fff",backgroundColor:me.a[500]},card:{maxWidth:400,maxHeight:250,textAlign:"center",align:"center"},media:{height:150}},fe=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement(de.a,{className:e.card},s.a.createElement(ge.a,{className:e.media,image:this.props.team.cdnImage,title:this.props.team.name}),s.a.createElement(ve.a,null,s.a.createElement(L.a,{gutterBottom:!0,variant:"h5",component:"h2"},this.props.index<3?s.a.createElement(G.a,{className:e.winnersAvatar},this.props.index+1):s.a.createElement(G.a,null),this.props.team.name)))}}]),t}(s.a.Component),ye=Object(C.withStyles)(be)(fe),Oe=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(le.a,{onDragEnd:this.props.onDragEnd},s.a.createElement(le.c,{droppableId:"droppable"},function(t,n){return s.a.createElement("div",Object.assign({},t.droppableProps,{ref:t.innerRef,style:(r=n.isDraggingOver,{background:r?"lightblue":"lightgrey",padding:8,width:400})}),e.props.teams.map(function(e,t){return s.a.createElement(le.b,{key:e.node.id,draggableId:e.node.id,index:t},function(n,r){return s.a.createElement("div",Object.assign({ref:n.innerRef},n.draggableProps,n.dragHandleProps,{style:(i=n.draggableProps.style,Object(a.a)({userSelect:"none",padding:16,margin:"0 0 ".concat(8,"px 0"),background:"white"},i))}),s.a.createElement(ye,{index:t,team:e.node}));var i})}),t.placeholder);var r}))}}]),t}(s.a.Component),je=n(161),we=n.n(je),ke=n(81),Se=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r))))._confirm=function(e){var t=e.upsertPlayerEntry.entry,a=t.event.id;n.props.saveEntry(a,t)},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes,n=this.props,a=n.teams,r=n.currentEvent,i=r.number,o=a.slice(0,3).map(function(e){return e.node.name}),c=Object(S.a)(o,3),l=c[0],u=c[1],m=c[2];return s.a.createElement(d.b,{mutation:w,variables:{eventNumber:i,team1:l,team2:u,team3:m},onCompleted:function(t){return e._confirm(t)},onError:function(t){return e.props.setSaveError(t)}},function(n){return s.a.createElement(s.a.Fragment,null,s.a.createElement($.a,{variant:"contained",color:"primary",disabled:4===r.status||!e.props.saveActivated,className:t.button,size:"large",onClick:n},"Save",s.a.createElement(we.a,{className:t.rightIcon})),s.a.createElement(L.a,{component:"h4",variant:"h6",className:t.error},e.props.saveError||""))})}}]),t}(s.a.Component),Ce=Object(C.withStyles)(function(e){return{button:{margin:e.spacing.unit},rightIcon:{marginLeft:e.spacing.unit,verticalAlign:"center",fontSize:25},error:{color:ke.red[500]}}})(Se),xe=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement("main",{className:e.content},s.a.createElement(L.a,{variant:"h5",className:e.title},this.props.currentEvent?"Event #".concat(this.props.currentEvent.number," - ").concat(this.props.currentEvent.name):"",this.props.currentEvent&&4===this.props.currentEvent.status?s.a.createElement(se.a,{style:{fontSize:20,verticalAlign:"center",paddingLeft:5}}):""),s.a.createElement(Ce,{saveActivated:this.props.saveActivated,teams:this.props.teams,currentEvent:this.props.currentEvent,saveEntry:this.props.saveEntry,saveError:this.props.saveError,setSaveError:this.props.setSaveError}),s.a.createElement(Oe,{teams:this.props.teams,onDragEnd:this.props.onDragEnd}))}}]),t}(s.a.Component),Ne=Object(C.withStyles)(function(e){return{content:{flexGrow:1,padding:3*e.spacing.unit},title:{margin:"".concat(8*e.spacing.unit,"px 0 ").concat(2*e.spacing.unit,"px")},toolbar:e.mixins.toolbar}})(xe),Ae=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.classes;return s.a.createElement(V.a,{className:e.drawer,variant:"permanent",anchor:"right",classes:{paper:e.drawerPaper}},s.a.createElement("div",{className:e.toolbar}),s.a.createElement(de.a,{className:e.card},s.a.createElement(ve.a,null,s.a.createElement(L.a,{variant:"h4",component:"h2",align:"center"},this.props.profile.username))),s.a.createElement(de.a,{className:e.card},s.a.createElement(ve.a,null,s.a.createElement(L.a,null,s.a.createElement("strong",null,"Overall points: "),this.props.profile.points),s.a.createElement(L.a,null,s.a.createElement("strong",null,"Overall rank: "),-1!==this.props.profile.rank?this.props.profile.rank:this.props.marblelympics.playerCount),s.a.createElement(L.a,null,s.a.createElement("strong",null,"Total players: "),this.props.marblelympics.playerCount))),s.a.createElement(de.a,{className:e.card},s.a.createElement(ve.a,null,s.a.createElement(L.a,{variant:"h5",component:"h5",align:"center"},"EVENT DETAILS"),s.a.createElement(L.a,{variant:"h6",component:"h6",align:"center"},"#".concat(this.props.currentEvent.number)),s.a.createElement(L.a,{variant:"h6",component:"h6",align:"center"},"".concat(this.props.currentEvent.name)),s.a.createElement(L.a,null,s.a.createElement("strong",null,"Event points: "),this.props.currentEventEntry?this.props.currentEventEntry.points:"0"),s.a.createElement(L.a,null,s.a.createElement("strong",null,"Event rank: "),this.props.currentEventEntry&&-1!==this.props.currentEventEntry.rank?this.props.currentEventEntry.rank:this.props.currentEvent.entryCount),s.a.createElement(L.a,null,s.a.createElement("strong",null,"Total entries for event: "),this.props.currentEvent.entryCount))))}}]),t}(s.a.Component),Te=Object(C.withStyles)(function(e){return{drawer:{width:320,flexShrink:0},drawerPaper:{width:320},toolbar:e.mixins.toolbar,card:{minWidth:275},title:{fontSize:14}}})(Ae),Ie=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(s)))).state={profile:{},marblelympics:{},teams:[],events:{},currentEvent:{},eventEntries:{},saveActivated:!1,saveError:""},n.teamsSorted=!1,n.arrayToObject=function(e,t){return e.reduce(function(e,n){return e[t?n.node[t].id:n.node.id]=n.node,e},{})},n.sortTeamsFromEntries=function(){var e=n.state.eventEntries[n.state.currentEvent.id];if(!n.teamsSorted&&e){var t=e.selections.map(function(e){return e.team.id}),a=n.state.teams;a.map(function(e,n){var r=t.indexOf(e.node.id);if(-1!==r){var s=[a[r],a[n]];a[n]=s[0],a[r]=s[1]}return a[n]}),n.setState({teams:a}),n.teamsSorted=!0}},n.switchEvent=function(e){var t=n.state.events[e];n.teamsSorted=!1,n.setState({currentEvent:t,saveActivated:!1,saveError:""})},n.reorder=function(e,t,n){var a=Array.from(e),r=a.splice(t,1),s=Object(S.a)(r,1)[0];return a.splice(n,0,s),a},n.onDragEnd=function(e){if(e.destination){var t=n.reorder(n.state.teams,e.source.index,e.destination.index);n.setState({teams:t,saveActivated:!0})}},n.saveEntry=function(e,t){var r=Object(a.a)({},n.state.eventEntries);r[e]=t,n.setState({eventEntries:r,saveActivated:!1,saveError:""})},n.setSaveError=function(e){var t=e.message.split(": ").slice(1).join("");n.setState({saveError:t})},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.data,t=e.me.user,n=t.id,a=t.email,r=t.username,s=e.me.marblelympicsParticipated.edges[0].node,i={id:n,email:a,username:r,points:s.points,rank:s.rank},o=e.me.marblelympicsParticipated.edges[0].node.marblelympics,c=o.teams.edges,l=this.arrayToObject(o.events.edges);delete o.teams,delete o.events;var u=l[Object.keys(l)[0]],m=this.arrayToObject(e.me.marblelympicsParticipated.edges[0].node.eventEntries.edges,"event");this.setState({profile:i,marblelympics:o,teams:c,events:l,currentEvent:u,eventEntries:m})}},{key:"componentDidUpdate",value:function(){this.sortTeamsFromEntries()}},{key:"render",value:function(){var e=this.props.classes;return s.a.createElement(s.a.Fragment,null,s.a.createElement(F,{history:this.props.history,year:this.state.marblelympics.year}),s.a.createElement("div",{className:e.root},s.a.createElement(ce,{events:this.state.events,enteredEvents:Object.keys(this.state.eventEntries),switchEvent:this.switchEvent}),s.a.createElement(Ne,{currentEvent:this.state.currentEvent,teams:this.state.teams,onDragEnd:this.onDragEnd,saveActivated:this.state.saveActivated,saveEntry:this.saveEntry,saveError:this.state.saveError,setSaveError:this.setSaveError}),s.a.createElement(Te,{profile:this.state.profile,marblelympics:this.state.marblelympics,currentEvent:this.state.currentEvent,currentEventEntry:this.state.eventEntries[this.state.currentEvent.id]})))}}]),t}(r.Component),Le=Object(C.withStyles)(function(){return{root:{display:"flex"}}})(Ie),Pe=n(162),$e=n.n(Pe),De=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){localStorage.getItem(D)||this.props.history.push("/login")}},{key:"render",value:function(){var e=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement(d.c,{query:k},function(t){var n=t.loading,a=t.error,r=t.data;return n?s.a.createElement($e.a,{style:{height:10}}):a?s.a.createElement("div",null,e.props.history.push("/login")):s.a.createElement(Le,{history:e.props.history,data:r})}))}}]),t}(r.Component),Me=n(75),Fe=n(163),We=n.n(Fe),ze=n(105),Be=n.n(ze),_e=n(107),Ue=n.n(_e),Re=n(106),qe=n.n(Re),He=n(165),Je=n.n(He),Ge=n(52),Ke=n.n(Ge),Ve=n(164),Qe=n.n(Ve),Xe=n(104),Ye=n.n(Xe),Ze=n(8),et=n.n(Ze),tt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).login=function(e){var t=e.tokenAuth.token;localStorage.setItem(D,t),location.reload(!0)},n.signup=function(e){var t=e.createPlayer.player.user.username;n.props.setMessage("User ".concat(t," created")),n.props.switchToLogin()},n._confirm=function(e){0===n.props.login?n.login(e):n.signup(e)},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes,n=this.props,a=n.username,r=n.password;return s.a.createElement(d.b,{mutation:0===this.props.login?O:j,variables:{username:a,password:r},onCompleted:function(t){return e._confirm(t)},onError:function(){return e.props.onError()}},function(n){return s.a.createElement($.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:t.submit,onClick:n},0===e.props.login?"Log in":"Sign up")})}}]),t}(s.a.Component),nt=et()(function(e){return{submit:{marginTop:3*e.spacing.unit}}})(tt),at=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={login:0,username:"",password:"",message:"",error:!1},n.handleTabChange=function(e,t){n.setState({login:t,username:"",password:"",error:!1})},n.setMessage=function(e){n.setState({message:e})},n.switchToLogin=function(){n.handleTabChange(0,0)},n.onError=function(){n.setState({error:!0})},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){localStorage.getItem(D)&&this.props.history.push("/")}},{key:"render",value:function(){var e=this,t=this.props.classes,n=this.state,a=n.login,r=n.username,i=n.password,o=n.message,c=n.error;return s.a.createElement("main",{className:t.main},s.a.createElement(We.a,null),s.a.createElement(Ke.a,{className:t.paper},s.a.createElement(N.a,{position:"static",style:{marginBottom:20}},s.a.createElement(Qe.a,{variant:"fullWidth",value:a,onChange:this.handleTabChange},s.a.createElement(Ye.a,{component:"a",onClick:function(e){return e.preventDefault()},label:"Log In",href:"login"}),s.a.createElement(Ye.a,{component:"a",onClick:function(e){return e.preventDefault()},label:"Sign Up",href:"signup"}))),s.a.createElement(G.a,{className:t.avatar},s.a.createElement(Je.a,null)),s.a.createElement(L.a,{component:"h1",variant:"h5"},0===a?"Log in":"Sign up"),s.a.createElement(L.a,{component:"h4",variant:"h6",className:t.error},o||""),c?s.a.createElement(L.a,{component:"h4",variant:"h6",className:t.error},0===a?"Invalid credentials":"Username already in use"):"",s.a.createElement(Be.a,{margin:"normal",required:!0,fullWidth:!0},s.a.createElement(qe.a,{htmlFor:"email"},"Username"),s.a.createElement(Ue.a,{id:"username",name:"username",autoComplete:"username",autoFocus:!0,value:r,onChange:function(t){return e.setState({username:t.target.value})}})),s.a.createElement(Be.a,{margin:"normal",required:!0,fullWidth:!0},s.a.createElement(qe.a,{htmlFor:"password"},"Password"),s.a.createElement(Ue.a,{name:"password",type:"password",id:"password",autoComplete:"current-password",value:i,onChange:function(t){return e.setState({password:t.target.value})}})),s.a.createElement(nt,{username:r,password:i,login:a,onError:this.onError,switchToLogin:this.switchToLogin,setMessage:this.setMessage})))}}]),t}(s.a.Component),rt=et()(function(e){return{main:Object(Me.a)({width:"auto",display:"block",marginLeft:3*e.spacing.unit,marginRight:3*e.spacing.unit},e.breakpoints.up(400+3*e.spacing.unit*2),{width:400,marginLeft:"auto",marginRight:"auto"}),paper:{marginTop:8*e.spacing.unit,display:"flex",flexDirection:"column",alignItems:"center",padding:"".concat(2*e.spacing.unit,"px ").concat(3*e.spacing.unit,"px ").concat(3*e.spacing.unit,"px")},avatar:{margin:e.spacing.unit,backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing.unit},error:{color:ke.red[500]}}})(at),st=n(375),it=n(376),ot=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("div",null,s.a.createElement(st.a,null,s.a.createElement(it.a,{exact:!0,path:"/",component:De}),s.a.createElement(it.a,{exact:!0,path:"/login",component:rt}))))}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ct=n(46),lt=n(168),ut=n(169),mt=n(374),pt=n(167);var dt=Object(pt.a)(function(e,t){var n=t.headers,r=localStorage.getItem(D);return{headers:Object(a.a)({},n,{authorization:r?"JWT ".concat(r):""})}}),ht=Object(lt.a)({uri:""}),vt=new ct.a({link:dt.concat(ht),cache:new ut.a});o.a.render(s.a.createElement(mt.a,null,s.a.createElement(d.a,{client:vt},s.a.createElement(ot,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[172,1,2]]]);
//# sourceMappingURL=main.e8c9bed4.chunk.js.map